<?xml version="1.0" encoding="UTF-8"?>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/JSP_Servlet/XHtml.xhtml to edit this template
-->
<!DOCTYPE html>
<html 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <h:head>
        <title>CRM History</title>
        <meta 
            name="viewport" 
            content="width=device-width, initial-scale=1.0"/>
    </h:head>
    <h:body>
        <h:form 
            id="tableHistory">
            <ui:include 
                src="/components/common/toolbar.xhtml"/>
            <p:growl 
                id="growl" 
                showDetail="true" />
            <p:dataTable 
                id="dt-clients-history" 
                widgetVar="dtClientsHistory" 
                paginator="true" 
                rows="5"
                paginatorPosition="bottom" 
                value="#{clientController.clients}"
                var="client"
                rowKey="#{client.id}">

                <f:facet 
                    name="header">
                    <div 
                        class="clients-table-header" 
                        style="display: flex;
                        align-items: center;
                        justify-content: space-between">
                        <span 
                            style="font-weight: bold">CLIENTS</span>
                        <p:commandButton 
                            value="New"
                            icon="pi pi-plus"
                            actionListener="#{clientController.openNew}"
                            update=":dialogs:manage-client-content"
                            oncomplete="PF('manageClientDialog').show"
                            styleClass="ui-button-success">
                            <p:resetInput target=":dialogs:manage-client-content"/>
                        </p:commandButton>
                    </div>
                </f:facet>

                <p:column 
                    headerText="Номер договора" 
                    sortBy="#{client.numberContract}">
                    <h:outputText 
                        value="#{client.numberContract}">
                    </h:outputText>
                </p:column>

                <p:column 
                    headerText="NAME" 
                    sortBy="#{client.client.clientLastName}">
                    <h:outputText 
                        value="#{client.client.clientLastName}">
                    </h:outputText>
                </p:column>
                <p:column 
                    headerText="PASSPORT" 
                    sortBy="#{client.client.clientPassport}">
                    <h:outputText 
                        value="#{client.client.clientPassport}">
                    </h:outputText>
                </p:column>

                <p:column 
                    headerText="DATE" 
                    sortBy="#{client.date}">
                    <h:outputText 
                        value="#{client.date}">
                        <f:convertDateTime 
                            pattern="dd.MM.yyyy" 
                            type="localDate"/>
                    </h:outputText>
                </p:column>
                <p:column 
                    headerText="DAYS" 
                    sortBy="#{client.days}">
                    <h:outputText 
                        value="#{client.days}"/>
                </p:column>

                <p:column 
                    headerText="LOCAL" 
                    sortBy="#{client.client.clientLocal}">
                    <h:outputText 
                        value="#{client.client.clientLocal}">
                    </h:outputText>

                </p:column>
                <p:column 
                    ariaHeaderText="Actions">
                    <p:commandButton 
                        icon="pi pi-pencil"
                        update=":dialogs:inputDialog"
                        oncomplete="PF('manageClientDialog').show()"
                        style="margin-right: .5rem"
                        styleClass="edit-button rounded-button ui-button-plain">
                        <f:setPropertyActionListener 
                            value="#{client}" 
                            target="#{clientController.selectedClient}"/>
                    </p:commandButton>
                    <p:commandButton 
                        class="ui-button-warning rounded-button" 
                        icon="pi pi-trash"
                        process="@this"
                        style="margin-right: .5rem"
                        oncomplete="PF('deleteClientDialog').show()">
                        <f:setPropertyActionListener 
                            value="#{client}" 
                            target="#{clientController.selectedClient}"/>
                    </p:commandButton>
                </p:column>

            </p:dataTable>

        </h:form>

        <h:form 
            id="dialogs">
            <p:dialog
                id="inputDialog"
                header="Client detail"
                showEffect="fade"
                widgetVar="manageClientDialog"
                responsive="true"
                modal="true">
                <p:outputPanel 
                    id="manage-client-content">
                    <p:outputPanel 
                        rendered="#{not empty clientController.selectedClient}">
                        <h:panelGrid 
                            id="evenDetails"
                            columns="2"
                            cellpadding="7">
                            <p:outputLabel 
                                for="dateC" 
                                value="Date"/>
                            <p:inplace>
                                <p:datePicker 
                                    id="dateC" 
                                    style="width:auto" 
                                    required="true"
                                    timeInput="true"
                                    value="#{clientController.selectedClient.date}"/>
                            </p:inplace>

                            <p:outputLabel 
                                for="name1">Name</p:outputLabel>
                            <p:inputText 
                                id="name1"
                                value="#{clientController.selectedClient.client.clientName}"
                                required="true"/>

                            <p:outputLabel 
                                for="name1">Last Name</p:outputLabel>
                            <p:inputText 
                                id="name1"
                                value="#{clientController.selectedClient.client.clientLastName}"
                                required="true"/>

                            <p:outputLabel 
                                for="name1">Passport</p:outputLabel>
                            <p:inputText 
                                id="name1"
                                value="#{clientController.selectedClient.client.clientPassport}"
                                required="true"/>

                            <p:outputLabel 
                                for="name1">Local</p:outputLabel>
                            <p:inputText 
                                id="name1"
                                value="#{clientController.selectedClient.client.clientLocal}"
                                required="true"/>

                            <p:outputLabel 
                                for="days1">Days</p:outputLabel>
                            <p:inputText 
                                id="days1"
                                value="#{clientController.selectedClient.days}"
                                required="true"/>

                        </h:panelGrid>
                    </p:outputPanel>
                </p:outputPanel>
                <f:facet 
                    name="footer">
                    <p:commandButton 
                        value="Save"
                        icon="pi pi-check"
                        actionListener="#{clientController.saveClient}"
                        update="manage-client-content :tableHistory:dt-clients-history"
                        process="manage-client-content @this"
                        onclick="PF('manageClientDialog').hide"/>

                    <p:commandButton 
                        value="Cancel"
                        icon="pi pi-times"
                        onclick="PF('manageClientDialog').hide"
                        styleClass="ui-button-danger"
                        type="button"/>
                </f:facet>
            </p:dialog>
            <p:confirmDialog 
                widgetVar="deleteClientDialog" 
                showEffect="fade" 
                width="300" 
                message="Delete client?"
                header="Confirm"
                severity="warn">
                <p:commandButton 
                    value="Yes"
                    icon="pi pi-check"
                    styleClass="rounded-button ui-button-primary"
                    actionListener="#{clientController.deleteClient}"
                    process="@this"
                    update=":tableHistory:dt-clients-history"
                    oncomplete="PF('deleteClientDialog').hide()"/>
                <p:commandButton 
                    value="No" 
                    icon="pi pi-times" 
                    styleClass="rounded-button ui-button-danger"
                    onclick="PF('deleteClientDialog').hide()"/>
            </p:confirmDialog>
        </h:form>
    </h:body>
</html>